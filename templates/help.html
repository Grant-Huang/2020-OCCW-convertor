{% extends "base.html" %}

{% block title %}{{ t('help_title') }} - {{ t('system_name') }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- 页面标题 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex align-items-center">
                <i class="fas fa-question-circle fa-2x text-primary me-3"></i>
                <div>
                    <h2 class="mb-0">{{ t('help_title') }}</h2>
                    <p class="text-muted mb-0">{{ t('system_name') }} {{ t('help_usage_guide') }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 快速导航 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-map me-2"></i>{{ t('help_usage_guide') }}</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <a href="#overview" class="btn btn-outline-primary btn-sm w-100 mb-2">
                                <i class="fas fa-info-circle me-1"></i>{{ t('help_system_intro') }}
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="#workflow" class="btn btn-outline-primary btn-sm w-100 mb-2">
                                <i class="fas fa-flow-chart me-1"></i>{{ t('help_usage_guide') }}
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="#features" class="btn btn-outline-primary btn-sm w-100 mb-2">
                                <i class="fas fa-cogs me-1"></i>{{ t('help_main_features') }}
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="#troubleshooting" class="btn btn-outline-primary btn-sm w-100 mb-2">
                                <i class="fas fa-tools me-1"></i>{{ t('help_technical_support') }}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 系统概述 -->
    <div class="row mb-4" id="overview">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>{{ t('help_system_intro') }}</h5>
                </div>
                <div class="card-body">
                    <h6 class="text-primary">{{ t('help_system_intro') }}</h6>
                    <p>{{ t('help_system_intro_desc') }}</p>
                    
                    <div class="alert alert-info">
                        <h6 class="alert-heading"><i class="fas fa-shield-alt me-2"></i>{{ t('help_permissions') }}</h6>
                        <p class="mb-2"><strong>{{ t('help_normal_users') }}</strong>：{{ t('help_normal_users_desc') }}</p>
                        <p class="mb-0"><strong>{{ t('help_admin_users') }}</strong>：{{ t('help_admin_users_desc') }}</p>
                    </div>
                    
                    <h6 class="text-primary mt-4">{{ t('help_main_functionality') }}</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>{{ t('help_pdf_upload_desc') }}</li>
                                <li><i class="fas fa-check text-success me-2"></i>{{ t('help_sku_generation_desc') }}</li>
                                <li><i class="fas fa-check text-success me-2"></i>{{ t('help_price_management_desc') }}</li>
                                <li><i class="fas fa-check text-success me-2"></i>{{ t('help_multi_export_desc') }}</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>{{ t('help_multilang_desc') }}</li>
                                <li><i class="fas fa-check text-success me-2"></i>{{ t('help_auto_parse_desc') }}</li>
                                <li><i class="fas fa-check text-success me-2"></i>{{ t('help_sku_generation_desc') }}</li>
                                <li><i class="fas fa-check text-success me-2"></i>{{ t('help_price_management_desc') }}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 使用流程 -->
    <div class="row mb-4" id="workflow">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-flow-chart me-2"></i>{{ t('help_usage_guide') }}</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="timeline">
                                <div class="timeline-item">
                                    <div class="timeline-marker bg-primary">1</div>
                                    <div class="timeline-content">
                                        <h6 class="text-primary">{{ t('help_step1') }}</h6>
                                        <p>{{ t('help_step1_desc') }}</p>
                                    </div>
                                </div>
                                
                                <div class="timeline-item">
                                    <div class="timeline-marker bg-info">2</div>
                                    <div class="timeline-content">
                                        <h6 class="text-info">{{ t('help_step2') }}</h6>
                                        <p>{{ t('help_step2_desc') }}</p>
                                    </div>
                                </div>
                                
                                <div class="timeline-item">
                                    <div class="timeline-marker bg-warning">3</div>
                                    <div class="timeline-content">
                                        <h6 class="text-warning">{{ t('help_step3') }}</h6>
                                        <p>{{ t('help_step3_desc') }}</p>
                                    </div>
                                </div>
                                
                                <div class="timeline-item">
                                    <div class="timeline-marker bg-success">4</div>
                                    <div class="timeline-content">
                                        <h6 class="text-success">{{ t('help_step4') }}</h6>
                                        <p>{{ t('help_step4_desc') }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 功能详解 -->
    <div class="row mb-4" id="features">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>{{ t('help_main_features') }}</h5>
                </div>
                <div class="card-body">
                    <div class="accordion" id="featuresAccordion">
                        <!-- PDF解析功能 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="pdfParsing">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePdfParsing">
                                    <i class="fas fa-file-pdf me-2"></i>{{ t('help_pdf_upload') }}
                                </button>
                            </h2>
                            <div id="collapsePdfParsing" class="accordion-collapse collapse show" data-bs-parent="#featuresAccordion">
                                <div class="accordion-body">
                                    <h6>解析内容：</h6>
                                    <ul>
                                        <li><strong>产品信息</strong>：产品代码、描述、序号</li>
                                        <li><strong>数量数据</strong>：从合并列中智能提取数量和用户编码</li>
                                        <li><strong>价格信息</strong>：单价、总价（支持带逗号的金额格式）</li>
                                        <li><strong>门板颜色</strong>：自动识别门板样式和颜色信息</li>
                                        <li><strong>总价核算</strong>：与PDF中的总价进行对比验证</li>
                                    </ul>
                                    
                                    <h6 class="mt-3">特殊处理：</h6>
                                    <ul>
                                        <li>智能区分以数字开头和字母开头的产品代码</li>
                                        <li>自动处理页面分隔和格式变化</li>
                                        <li>支持多页PDF文档的连续解析</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- SKU生成规则 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="skuRules">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSkuRules">
                                    <i class="fas fa-code me-2"></i>SKU生成规则
                                </button>
                            </h2>
                            <div id="collapseSkuRules" class="accordion-collapse collapse" data-bs-parent="#featuresAccordion">
                                <div class="accordion-body">
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead class="table-dark">
                                                <tr>
                                                    <th>产品类型</th>
                                                    <th>判断条件</th>
                                                    <th>SKU生成规则</th>
                                                    <th>示例</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><span class="badge bg-primary">Cabinet</span></td>
                                                    <td>描述包含"Cabinet"</td>
                                                    <td><code>OCCW编码 + "-PLY-" + 花色</code></td>
                                                    <td><code>W3036-PLY-SSW</code></td>
                                                </tr>
                                                <tr>
                                                    <td><span class="badge bg-info">Hardware</span></td>
                                                    <td>描述包含"Hardware"</td>
                                                    <td><code>"HW-" + 用户编码</code></td>
                                                    <td><code>HW-H123</code></td>
                                                </tr>
                                                <tr>
                                                    <td><span class="badge bg-warning">Accessory</span></td>
                                                    <td>描述包含"Accessory"</td>
                                                    <td><code>花色 + "-" + 用户编码</code></td>
                                                    <td><code>SSW-ACC001</code></td>
                                                </tr>
                                                <tr>
                                                    <td><span class="badge bg-secondary">其他</span></td>
                                                    <td>不符合上述条件</td>
                                                    <td><code>花色 + "-" + 用户编码</code></td>
                                                    <td><code>SSW-MISC001</code></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <div class="alert alert-info mt-3">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <strong>注意：</strong>SKU生成规则可以在"配置"页面进行自定义修改。
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 价格管理 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="priceManagement">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePriceManagement">
                                    <i class="fas fa-dollar-sign me-2"></i>价格管理
                                </button>
                            </h2>
                            <div id="collapsePriceManagement" class="accordion-collapse collapse" data-bs-parent="#featuresAccordion">
                                <div class="accordion-body">
                                    <h6>OCCW价格表管理：</h6>
                                    <ul>
                                        <li><strong>批量导入</strong>：支持Excel文件批量导入价格数据</li>
                                        <li><strong>手动添加</strong>：可以手动添加单个SKU的价格信息</li>
                                        <li><strong>实时更新</strong>：修改价格后立即生效，无需重启系统</li>
                                        <li><strong>数据导出</strong>：支持将价格表导出为Excel或CSV格式</li>
                                        <li><strong>数据验证</strong>：自动检查重复SKU和无效价格</li>
                                    </ul>
                                    
                                    <h6 class="mt-3">Excel导入格式要求：</h6>
                                    <div class="table-responsive">
                                        <table class="table table-sm table-bordered">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>列名</th>
                                                    <th>数据类型</th>
                                                    <th>说明</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>内部参考号</td>
                                                    <td>文本</td>
                                                    <td>系统SKU标识，不能为空</td>
                                                </tr>
                                                <tr>
                                                    <td>销售价</td>
                                                    <td>数字</td>
                                                    <td>产品价格，必须为正数</td>
                                                </tr>
                                                <tr>
                                                    <td>变体值</td>
                                                    <td>文本</td>
                                                    <td>门板或柜身变体，可为空。格式：门板: XXX 或 柜身: XXX</td>
                                                </tr>
                                                <tr>
                                                    <td>名称</td>
                                                    <td>文本</td>
                                                    <td>产品名称，不能为空</td>
                                                </tr>
                                                <tr>
                                                    <td>产品类别/名称</td>
                                                    <td>文本</td>
                                                    <td>产品分类，支持：RTA Assm.组合件、Door、BOX、Ending Panel、Molding、Toe Kick、Filler等</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- SKU映射管理 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="skuMapping">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSkuMapping">
                                    <i class="fas fa-exchange-alt me-2"></i>SKU映射管理
                                </button>
                            </h2>
                            <div id="collapseSkuMapping" class="accordion-collapse collapse" data-bs-parent="#featuresAccordion">
                                <div class="accordion-body">
                                    <h6>映射机制：</h6>
                                    <p>当系统生成的SKU在OCCW价格表中找不到精确匹配时，会提供以下选项：</p>
                                    <ul>
                                        <li><strong>下拉选择</strong>：显示包含用户编码的相关SKU列表</li>
                                        <li><strong>手动输入</strong>：当没有相关SKU时，提供文本输入框</li>
                                        <li><strong>映射保存</strong>：用户选择后自动保存映射关系，下次处理时自动应用</li>
                                    </ul>
                                    
                                    <h6 class="mt-3">映射管理功能：</h6>
                                    <ul>
                                        <li><strong>查看所有映射</strong>：在"SKU映射"页面查看所有保存的映射关系</li>
                                        <li><strong>编辑映射</strong>：可以修改已有的映射关系</li>
                                        <li><strong>删除映射</strong>：删除不再需要的映射关系</li>
                                        <li><strong>批量管理</strong>：支持批量删除和修改操作</li>
                                    </ul>
                                    
                                    <div class="alert alert-warning mt-3">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <strong>提示：</strong>映射关系保存后，在表格中会显示映射后的SKU而不是原始生成的SKU。
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 导出功能 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="exportFeatures">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExportFeatures">
                                    <i class="fas fa-download me-2"></i>导出功能
                                </button>
                            </h2>
                            <div id="collapseExportFeatures" class="accordion-collapse collapse" data-bs-parent="#featuresAccordion">
                                <div class="accordion-body">
                                    <h6>支持的导出格式：</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6 class="text-primary">2020格式导出：</h6>
                                            <ul>
                                                <li><strong>Excel (.xlsx)</strong>：包含所有列信息</li>
                                                <li><strong>CSV (.csv)</strong>：纯文本格式，便于其他系统导入</li>
                                                <li><strong>PDF (.pdf)</strong>：专业的打印格式</li>
                                            </ul>
                                            <p><small class="text-muted">包含：序号、Code、数量、花色、2020单价、2020总价、OCCW SKU、OCCW单价、OCCW总价</small></p>
                                        </div>
                                        <div class="col-md-6">
                                            <h6 class="text-success">OCCW格式导出：</h6>
                                            <ul>
                                                <li><strong>Excel (.xlsx)</strong>：专门的OCCW报价单格式</li>
                                            </ul>
                                            <p><small class="text-muted">包含：序号、OCCW SKU、数量、OCCW单价、OCCW总价</small></p>
                                        </div>
                                    </div>
                                    
                                    <h6 class="mt-3">导出特性：</h6>
                                    <ul>
                                        <li>自动添加总计行和合计信息</li>
                                        <li>保持数字格式和货币符号</li>
                                        <li>支持中文文件名</li>
                                        <li>文件大小优化，导出速度快</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 问题解决 -->
    <div class="row mb-4" id="troubleshooting">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-tools me-2"></i>常见问题解决</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-danger">PDF解析问题</h6>
                            <div class="card bg-light mb-3">
                                <div class="card-body">
                                    <h6 class="card-title">Q: PDF上传后无法解析或解析错误？</h6>
                                    <p class="card-text">
                                        <strong>解决方案：</strong><br>
                                        1. 确认PDF是由2020软件生成的标准报价单<br>
                                        2. 检查PDF文件是否损坏<br>
                                        3. 使用"显示原始PDF文本"按钮查看解析内容<br>
                                        4. 确认PDF中包含完整的产品列表和价格信息
                                    </p>
                                </div>
                            </div>
                            
                            <div class="card bg-light mb-3">
                                <div class="card-body">
                                    <h6 class="card-title">Q: 产品数量或价格解析错误？</h6>
                                    <p class="card-text">
                                        <strong>解决方案：</strong><br>
                                        1. 检查PDF中的数量和价格格式是否标准<br>
                                        2. 确认合并列的格式符合预期（数量+用户编码）<br>
                                        3. 查看系统显示的总价对比信息<br>
                                        4. 必要时手动修正数据
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h6 class="text-warning">SKU和价格问题</h6>
                            <div class="card bg-light mb-3">
                                <div class="card-body">
                                    <h6 class="card-title">Q: OCCW价格显示为$0.00？</h6>
                                    <p class="card-text">
                                        <strong>解决方案：</strong><br>
                                        1. 检查OCCW价格表是否已正确导入<br>
                                        2. 确认SKU映射是否正确<br>
                                        3. 在"价格管理"页面手动添加缺失的SKU价格<br>
                                        4. 检查SKU格式是否符合OCCW标准
                                    </p>
                                </div>
                            </div>
                            
                            <div class="card bg-light mb-3">
                                <div class="card-body">
                                    <h6 class="card-title">Q: SKU无法找到匹配项？</h6>
                                    <p class="card-text">
                                        <strong>解决方案：</strong><br>
                                        1. 使用下拉列表中的相似SKU<br>
                                        2. 手动输入正确的OCCW SKU<br>
                                        3. 在"配置"页面调整SKU生成规则<br>
                                        4. 联系管理员更新价格表
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h6 class="text-info mt-4">性能优化建议</h6>
                    <div class="alert alert-info">
                        <ul class="mb-0">
                            <li>定期清理不需要的SKU映射关系</li>
                            <li>保持OCCW价格表更新，减少手动映射需求</li>
                            <li>使用标准格式的PDF文件，提高解析准确度</li>
                            <li>大文件处理时请耐心等待，避免重复操作</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 联系支持 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-headset me-2"></i>{{ t('help_technical_support') }}</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary">{{ t('help_contact_info') }}</h6>
                            <p>{{ t('help_company_full') }}</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="text-center">
                                <i class="fas fa-envelope fa-2x text-primary mb-2"></i>
                                <h6>{{ t('help_email_support') }}</h6>
                                <p class="text-muted"><code>info@oppeincabinet.ca</code></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-center">
                                <i class="fas fa-phone fa-2x text-success mb-2"></i>
                                <h6>{{ t('help_phone_support') }}</h6>
                                <p class="text-muted"><code>+1 (778) 532-6233</code></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 版本信息 -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="alert alert-light">
                                <h6 class="alert-heading">{{ t('help_version_info') }}</h6>
                                <p class="mb-0">{{ t('help_current_version') }}: <strong>{{ version }}</strong></p>
                                <small class="text-muted">{{ t('help_company_name') }} - {{ t('company_full_name') }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* 时间轴样式 */
.timeline {
    position: relative;
    padding-left: 50px;
}

.timeline-item {
    position: relative;
    margin-bottom: 30px;
}

.timeline-item:before {
    content: '';
    position: absolute;
    left: -32px;
    top: 30px;
    height: calc(100% + 10px);
    width: 2px;
    background-color: #dee2e6;
}

.timeline-item:last-child:before {
    display: none;
}

.timeline-marker {
    position: absolute;
    left: -42px;
    top: 0;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 14px;
}

.timeline-content {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border-left: 3px solid #007bff;
}

/* 平滑滚动 */
html {
    scroll-behavior: smooth;
}

/* 代码样式 */
code {
    background-color: #f8f9fa;
    padding: 2px 4px;
    border-radius: 3px;
    font-size: 87.5%;
}
</style>
{% endblock %} 